qh.component('sort-filter', function(ngm, qhm) {
	ngm.directive('listOptionsSort', function() {
		var scopeAttributes = {
			name:"@", 
			columns:"@", 
			current:"@",
		};
		return {
			restrict: 'A',
			scope: true,
			templateUrl: qhm.getPath()+"/partial/sort.html",
			controller: ["$scope", "$attrs", qhm.getComponent('factory', 'sort').getFullName(), function($scope, $attrs, sort) {
				// Perhaps 5 placeholders to stop the screen jumping around.
				// That would be generated by list.

				var watchParams = [];
				$.each(scopeAttributes, function(name) {
					watchParams[name] = "$attrs."+name;
				});
				
				$scope.$on(qhm.getComponent('factory', 'sort').getFullName()+".addSort", function(event, data){
					// The sort is added, and needs to be handled in the partial.
					$scope.sort = sort.getSort($attrs.name);
				});
				$scope.$watchCollection("["+watchParams.join(",")+"]", function () {
					if ($attrs.columns) {
						var columns = JSON.parse($attrs.columns);
						var current = JSON.parse($attrs.current);
						sort.addSort($attrs.name, columns, current);
					}
				});

			}],
		};
	});
});
