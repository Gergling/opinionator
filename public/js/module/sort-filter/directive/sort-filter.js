qh.component('sort-filter', function(ngm, qhm) {
	ngm.directive('listOptionsSortFilter', function() {
		var scopeAttributes = {
			name:"@", 
			columns:"@", 
			currentSort:"@",
		};
		return {
			restrict: 'A',
			scope: true,
			templateUrl: qhm.getPath()+"/partial/sort-filter.html",
			controller: ["$scope", "$attrs", qhm.getComponent('factory', 'sort-filter').getFullName(), function($scope, $attrs, sortFilter) {
				// Perhaps 5 placeholders to stop the screen jumping around.
				// That would be generated by list.

				var watchParams = [];
				$.each(scopeAttributes, function(name) {
					watchParams[name] = "$attrs."+name;
				});
				
				$scope.$on(qhm.getComponent('factory', 'sort-filter').getFullName()+".addSortFilter", function(event, data){
					// The sort is added, and needs to be handled in the partial.
					$scope.sortFilter = sortFilter.getSortFilter($attrs.name);
				});
				$scope.$watchCollection("["+watchParams.join(",")+"]", function () {
					if ($attrs.columns) {
						var columns = JSON.parse($attrs.columns);
						var sortFilter = sortFilter.addSortFilter($attrs.name, columns);
						
						var currentSort = JSON.parse($attrs.currentSort);
						sortFilter.sort.setCurrent(currentSort);
					}
				});
			}],
		};
	});
});
